(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{3624:function(t,i,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ray-casting",function(){return n(1480)}])},3254:function(t,i,n){"use strict";function e(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function r(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}n.d(i,{Nm:function(){return o},qT:function(){return u}});var o,s=function(t,i,n,e,r){return n*e*r+i*e+t},h=function(t,i,n){var e=Math.floor(t/(i*n));return{x:(t-=e*i*n)%i,y:Math.floor(t/i),z:e}};!function(t){t.TOP="TOP",t.RIGHT="RIGHT",t.LEFT="LEFT",t.BOTTOM="BOTTOM",t.FRONT="FRONT",t.BACK="BACK"}(o||(o={}));var u=function(){function t(i,n,e){var u,a=this;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.hasNeighbour=function(t,i,n,e){var r=a.buffer,o=a.getNeighbourIndex(t,i,n,e);return!(o<0||o>r.length)&&(0===i&&1===n&&0===e&&console.log(t,i,n,e,h(o,a.width,a.height),r[o]),!!r[o])},this._width=i,this._height=n,this._depth=e,this.buffer=new Array(this.width*this.depth*this.height),this.resetBuffer(),this.neighbourFunctionMap=(r(u={},o.TOP,(function(t,e,r){return a.isYWithinBounds(e+1)?s(t,e+1,r,i,n):-1})),r(u,o.BOTTOM,(function(t,e,r){return a.isYWithinBounds(e-1)?s(t,e-1,r,i,n):-1})),r(u,o.BACK,(function(t,e,r){return a.isZWithinBounds(r-1)?s(t,e,r-1,i,n):-1})),r(u,o.FRONT,(function(t,e,r){return a.isZWithinBounds(r+1)?s(t,e,r+1,i,n):-1})),r(u,o.LEFT,(function(t,e,r){return a.isXWithinBounds(t-1)?s(t-1,e,r,i,n):-1})),r(u,o.RIGHT,(function(t,e,r){return a.isXWithinBounds(t+1)?s(t+1,e,r,i,n):-1})),u)}var i,n,u,a=t.prototype;return a.isYWithinBounds=function(t){return t>0&&t<this.height},a.isXWithinBounds=function(t){return t>0&&t<this.width},a.isZWithinBounds=function(t){return t>0&&t<this.depth},a.resetBuffer=function(){for(var t=0;t<this.buffer.length;t++)this.buffer[t]=""},a.getNeighbourIndex=function(t,i,n,e){return this.neighbourFunctionMap[t](i,n,e)},a.setValue=function(t,i,n,e){var r=this,o=r.width,h=r.height,u=r.depth;t<0||i<0||n<0||t>=o||i>=h||n>=u||(this.buffer[s(t,i,n,o,h)]=e)},a.getValue=function(t,i,n){var e=this,r=e.width,o=e.height,h=e.depth;if(!(t<0||i<0||n<0||t>=r||i>=o||n>=h))return this.buffer[s(t,i,n,r,o)]},a.forEach=function(t){var i=this;this.buffer.forEach((function(n,e){var r=h(e,i.width,i.height),o=r.x,s=r.y,u=r.z;return t(n,o,s,u)}))},i=t,(n=[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}}])&&e(i.prototype,n),u&&e(i,u),t}()},931:function(t,i,n){"use strict";n.d(i,{O:function(){return e}});var e=function(){function t(i,n,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=n,this.z=e}var i=t.prototype;return i.getAbsoluteVector=function(){return new t(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))},i.getDirectionVector=function(){return new t(0===this.x?0:Math.abs(this.x)/this.x,0===this.y?0:Math.abs(this.y)/this.y,0===this.z?0:Math.abs(this.z)/this.z)},i.getLongest=function(){var t=this.getAbsoluteVector();return t.x>t.y&&t.x>t.z?"x":t.y>t.z&&t.y>t.x?"y":"z"},i.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.getNormal=function(){var i=this.getLength();return new t(this.x/i,this.y/i,this.z/i)},i.multiply=function(i){return new t(this.x*i,this.y*i,this.z*i)},i.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z)},i.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z)},i.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},i.ceil=function(){return new t(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},i.clone=function(){return new t(this.x,this.y,this.z)},i.addMutate=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.subtractMutate=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.cloneFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.multiplyMutate=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.floorMutate=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},i.scalarProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.toString=function(){return"{x:".concat(this.x,",y:").concat(this.y,",z:").concat(this.z,"}")},i.serialize=function(){return JSON.stringify({x:this.x,y:this.y,z:this.z})},t}()},1480:function(t,i,n){"use strict";n.r(i),n.d(i,{default:function(){return H}});var e=n(5893),r=n(9008),o=n.n(r),s=n(7948),h=n(5861),u=n(6447),a=n(7507),c=n(3321),f=n(7294),l=n(1664),y=n.n(l),d=n(4051),x=n.n(d);function p(t,i,n,e,r,o,s){try{var h=t[o](s),u=h.value}catch(a){return void n(a)}h.done?i(u):Promise.resolve(u).then(e,r)}var g=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.context=i.getContext("bitmaprenderer")}return t.prototype.drawBitmap=function(t,i){var n,e=this;return(n=x().mark((function n(){var r,o,s,h;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new Uint8ClampedArray(t.buffer),s=new ImageData(o,i,i),n.next=5,createImageBitmap(s);case 5:h=n.sent,null===(r=e.context)||void 0===r||r.transferFromImageBitmap(h);case 7:case"end":return n.stop()}}),n)})),function(){var t=this,i=arguments;return new Promise((function(e,r){var o=n.apply(t,i);function s(t){p(o,e,r,s,h,"next",t)}function h(t){p(o,e,r,s,h,"throw",t)}s(void 0)}))})()},t}();function v(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function w(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}var z,m=function(t,i,n){return i*n+t};!function(t){t.TOP="TOP",t.RIGHT="RIGHT",t.LEFT="LEFT",t.BOTTOM="BOTTOM"}(z||(z={}));var M=function(){function t(i,n,e){var r,o=this;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this._width=i,this._height=n,this._buffer=new Array(this.width*this.height),this.resetBuffer(e),this.neighbourFunctionMap=(w(r={},z.TOP,(function(t,n){return o.isYWithinBounds(n+1)?m(t,n+1,i):-1})),w(r,z.BOTTOM,(function(t,n){return o.isYWithinBounds(n-1)?m(t,n-1,i):-1})),w(r,z.LEFT,(function(t,n){return o.isXWithinBounds(t-1)?m(t-1,n,i):-1})),w(r,z.RIGHT,(function(t,n){return o.isXWithinBounds(t+1)?m(t+1,n,i):-1})),r)}var i,n,e,r=t.prototype;return r.isYWithinBounds=function(t){return t>0&&t<this.height},r.isXWithinBounds=function(t){return t>0&&t<this.width},r.resetBuffer=function(t){for(var i=0;i<this._buffer.length;i++)this._buffer[i]=t},r.getNeighbourIndex=function(t,i,n){return this.neighbourFunctionMap[t](i,n)},r.hasNeighbour=function(t,i,n){var e=this._buffer,r=this.getNeighbourIndex(t,i,n);return!(r<0||r>e.length)&&!!e[r]},r.getNeighbourValue=function(t,i,n){var e=this._buffer,r=this.getNeighbourIndex(t,i,n);if(!(r<0||r>e.length))return e[r]},r.setValue=function(t,i,n){var e=this.width,r=this.height;t<0||i<0||t>=e||i>=r||(this._buffer[m(t,i,e)]=n)},r.getValue=function(t,i){var n=this.width,e=this.height;if(!(t<0||i<0||t>=n||i>=e))return this._buffer[m(t,i,n)]},r.forEach=function(t){var i=this;this._buffer.forEach((function(n,e){var r,o,s=(r=e,o=i.width,{x:r%o,y:Math.floor(r/o)});return t(n,s.x,s.y)}))},i=t,(n=[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"buffer",get:function(){return this._buffer}}])&&v(i.prototype,n),e&&v(i,e),t}(),b=n(3254),T=n(931),O=new T.O(0,0,0),B=new T.O(0,0,0),N=function(t,i,n){return n>=t&&n<i},P=function(t,i,n,e){var r=t.y+1,o=t.y,s=t.z+1,h=t.z;O.cloneFrom(i),B.cloneFrom(n);var u=(e-i.x)/n.x,a=i.addMutate(B.multiplyMutate(u));if(N(o,r,a.y)&&N(h,s,a.z))return a},_=function(t,i,n,e){var r=t.x+1,o=t.x,s=t.z+1,h=t.z;O.cloneFrom(i),B.cloneFrom(n);var u=(e-i.y)/n.y,a=i.addMutate(B.multiplyMutate(u));if(N(o,r,a.x)&&N(h,s,a.z))return a},F=function(t,i,n,e){var r=t.x+1,o=t.x,s=t.y+1,h=t.y;O.cloneFrom(i),B.cloneFrom(n);var u=(e-i.z)/n.z,a=i.addMutate(B.multiplyMutate(u));if(N(o,r,a.x)&&N(h,s,a.y))return a},C=function(t,i,n){if(i.x>0&&t.x<n.x){var e=P(n,t,i,n.x);if(e)return{intersection:e,direction:b.Nm.LEFT}}if(i.x<0&&t.x>n.x+1){var r=P(n,t,i,n.x+1);if(r)return{intersection:r,direction:b.Nm.RIGHT}}if(i.y>0&&t.y<n.y){var o=_(n,t,i,n.y);if(o)return{intersection:o,direction:b.Nm.BOTTOM}}if(i.y<0&&t.y>n.y+1){var s=_(n,t,i,n.y+1);if(s)return{intersection:s,direction:b.Nm.TOP}}if(i.z>0&&t.z<n.z){var h=F(n,t,i,n.z);if(h)return{intersection:h,direction:b.Nm.BACK}}if(i.z<0&&t.z>n.z+1){var u=F(n,t,i,n.z+1);if(u)return{intersection:u,direction:b.Nm.FRONT}}return{}};var E=function(){function t(i,n,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.receptors=new M(i,i,4278190080),this.position=n,this.orientation=e}var i=t.prototype;return i.updateByRay=function(t){var i,n=this.findIntersectionCoords(t);if(n){var e=parseInt((null===(i=this.receptors.getValue(n.x,n.y))||void 0===i?void 0:i.toString(16).slice(-2))||"0"),r=Math.min(e+t.strength,255).toString(16),o=parseInt("0xff".concat(r).concat(r).concat(r),16);this.receptors.setValue(n.x,n.y,o)}},i.updateByCollision=function(t){},i.findIntersectionCoords=function(t){var i=C(t.startPosition,t.direction,this.position),n=i.intersection,e=i.direction;if(n&&this.orientation===e)switch(this.orientation){case b.Nm.FRONT:case b.Nm.BACK:return{x:Math.floor((n.x-this.position.x)*this.receptors.width),y:Math.floor((n.y-this.position.y)*this.receptors.height)};case b.Nm.TOP:case b.Nm.BOTTOM:return{x:Math.floor((n.x-this.position.x)*this.receptors.width),y:Math.floor((n.z-this.position.z)*this.receptors.height)};case b.Nm.LEFT:case b.Nm.RIGHT:return{x:Math.floor((n.z-this.position.z)*this.receptors.width),y:Math.floor((n.y-this.position.y)*this.receptors.height)}}},i.reset=function(){this.receptors.resetBuffer(0)},t}();var R=function t(i,n,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.direction=i,this.strength=e,this.startPosition=n},I=new T.O(0,0,0),j=new T.O(0,0,0),k=new T.O(0,0,0),V=new T.O(0,0,0),W=new T.O(0,0,0),A=function(t,i){k.cloneFrom(t.startPosition).floorMutate(),W.cloneFrom(t.direction),j.x=Math.sqrt(1+Math.pow(t.direction.y/t.direction.x,2)+Math.pow(t.direction.z/t.direction.x,2)),j.y=Math.sqrt(1+Math.pow(t.direction.x/t.direction.y,2)+Math.pow(t.direction.z/t.direction.y,2)),j.z=Math.sqrt(1+Math.pow(t.direction.x/t.direction.z,2)+Math.pow(t.direction.y/t.direction.z,2)),t.direction.x<0?(V.x=-1,I.x=(t.startPosition.x-k.x)*j.x):(I.x=(k.x+1-t.startPosition.x)*j.x,V.x=1),t.direction.y<0?(I.y=(t.startPosition.y-k.y)*j.y,V.y=-1):(I.y=(k.y+1-t.startPosition.y)*j.y,V.y=1),t.direction.z<0?(I.z=(t.startPosition.z-k.z)*j.z,V.z=-1):(I.z=(k.z+1-t.startPosition.z)*j.z,V.z=1)},L=function(t,i,n,e){console.time("Ray Casting"),function(t,i){for(var n=Math.PI*(3-Math.sqrt(5)),e=0;e<i;e++){var r=1-e/(i-1)*2,o=Math.sqrt(1-r*r),s=n*e,h=Math.cos(s)*o,u=Math.sin(s)*o;t(new T.O(h,r,u))}}((function(e){!function(t,i,n){var e=0;for(A(t);t.strength>=1;){I.x<I.y&&I.x<I.z?(k.x+=V.x,e=I.x,I.x+=j.x):I.y<I.x&&I.y<I.z?(k.y+=V.y,e=I.y,I.y+=j.y):(k.z+=V.z,e=I.z,I.z+=j.z);var r=i.getValue(k.x,k.y,k.z);if(void 0===r)return;if(r){var o=new R(W.multiplyMutate(1.000001*e),t.startPosition,t.strength);if("eye"===r&&n.updateByRay(o),"ground"===r){var s=C(t.startPosition,o.direction,k),h=s.direction,u=s.intersection;if(!u)return;t.startPosition.cloneFrom(u),h!==b.Nm.TOP&&h!==b.Nm.BOTTOM||(t.direction.y=-1*t.direction.y),h!==b.Nm.LEFT&&h!==b.Nm.RIGHT||(t.direction.x=-1*t.direction.x),h!==b.Nm.BACK&&h!==b.Nm.FRONT||(t.direction.z=-1*t.direction.z),A(t),e=0,t.strength/=2;continue}return}}}(new R(e,n.clone(),255),t,i)}),e),console.timeEnd("Ray Casting")},H=function(){var t=(0,f.useState)(1e3),i=t[0],n=t[1],r=(0,f.useRef)(null),l=(0,f.useCallback)((function(){if(r.current){var t=new g(r.current),n=function(){for(var t=new b.qT(10,10,10),i=0;i<10;i++)for(var n=0;n<10;n++)t.setValue(i,0,n,"ground");return t}(),e=new E(300,new T.O(4,1,9),b.Nm.BACK),o=new T.O(4,4,9);n.setValue(e.position.x,e.position.y,e.position.z,"eye"),n.setValue(4,2,7,"ground"),n.setValue(3,1,9,"ground"),n.setValue(5,1,9,"ground"),L(n,e,o,i),t.drawBitmap(Uint32Array.from(e.receptors.buffer),300)}}),[i]);return(0,e.jsxs)(s.Z,{maxWidth:"lg",style:{minHeight:"100vh",paddingTop:"1rem",display:"flex",flexDirection:"column"},children:[(0,e.jsxs)(o(),{children:[(0,e.jsx)("title",{children:"Simulations"}),(0,e.jsx)("meta",{name:"description",content:" Ray casting"}),(0,e.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,e.jsx)(h.Z,{variant:"h3",component:"h1",children:"Ray casting"}),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,e.jsx)(y(),{href:"/optimize-mesh",children:"< Optimize Mesh"})}),(0,e.jsxs)(u.Z,{spacing:2,direction:"row",style:{flex:1},children:[(0,e.jsx)("div",{style:{flex:2},children:(0,e.jsx)("canvas",{style:{width:"100%",aspectRatio:"1 / 1"},ref:r})}),(0,e.jsxs)(u.Z,{spacing:2,style:{flex:1},children:["Rays amount: ",i,(0,e.jsx)(a.ZP,{min:2,max:1e7,step:1,value:i,onChange:function(t,i){return!Array.isArray(i)&&n(i)}}),(0,e.jsx)(c.Z,{onClick:l,children:"Cast Rays"})]})]})]})}}},function(t){t.O(0,[543,321,507,774,888,179],(function(){return i=3624,t(t.s=i);var i}));var i=t.O();_N_E=i}]);