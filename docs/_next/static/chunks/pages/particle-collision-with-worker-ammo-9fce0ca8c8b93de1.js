(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{5307:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/particle-collision-with-worker-ammo",function(){return i(2690)}])},2690:function(e,n,i){"use strict";i.r(n);var t=i(5893),r=i(5861),s=i(6447),o=i(7507),a=i(3321),u=i(7294),c=i(9477),l=i(7995),h=i(8861),d=i(3493),f=i.n(d);var p=function(){function e(n,i){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.shouldStop=!1,this.isInitialized=!1,this.idIndexMap={},this.sphereMeshes=[],this.worldSize=n,this.onFPSUpdate=i}var n=e.prototype;return n.initializeMeshes=function(e){var n=this;this.sphereMeshes=e.map((function(e,i){var t;n.idIndexMap[e.id]=i;var r=new c.xo$(1),s=new c.vBJ({color:16711680}),o=new c.Kj0(r,s);return o.position.set(e.x-n.worldSize/2,e.y-n.worldSize/2,e.z-n.worldSize/2),null===(t=n.scene)||void 0===t||t.add(o),o}))},n.update=function(e){var n=this;if(!this.isInitialized)return this.initializeMeshes(e),void(this.isInitialized=!0);e.forEach((function(e){!function(e,n,i){e.position.x=n.x-i/2,e.position.y=n.y-i/2,e.position.z=n.z-i/2,e.quaternion.x=n.quaternionX,e.quaternion.y=n.quaternionY,e.quaternion.z=n.quaternionZ,e.quaternion.w=n.quaternionW}(n.sphereMeshes[n.idIndexMap[e.id]],e,n.worldSize)}))},n.startAnimation=function(e){var n=this,i=(0,l.Y)(e,this.worldSize),t=i.scene,r=i.render,s=i.removeScene;this.scene=t;var o=Date.now(),a=function(){if(n.shouldStop)s();else{var e=Date.now();n.onFPSUpdate(1e3/(e-o)),o=e,requestAnimationFrame(a),r()}};a()},n.stopAnimation=function(){this.shouldStop=!0},e}();n.default=function(){var e=(0,u.useRef)(),n=(0,u.useRef)(null),c=(0,u.useRef)(null),l=(0,u.useState)(10),d=l[0],w=l[1],v=(0,u.useState)(10),m=v[0],x=v[1],S=(0,u.useRef)();(0,u.useEffect)((function(){return S.current=new Worker(new URL(i.p+i.u(782),i.b)),function(){var e;null===(e=S.current)||void 0===e||e.terminate()}}),[]);var y=(0,u.useCallback)((function(){var i,t;if(n.current&&S.current){e.current&&(e.current.stopAnimation(),S.current.postMessage({type:"STOP"}));e.current=new p(d,f()((function(e){c.current&&(c.current.innerText=e.toFixed(0))}),1e3)),e.current.startAnimation(n.current),S.current.onmessage=function(n){var i;null===(i=e.current)||void 0===i||i.update(n.data)},null===(i=S.current)||void 0===i||i.postMessage({type:"INITIALIZE",worldSize:d,particlesAmount:m}),null===(t=S.current)||void 0===t||t.postMessage({type:"START"})}}),[m,d]);return(0,t.jsxs)(h.T,{title:"Particle simulation with collisions and webworker",subtitle:"The same as before but this time I'm using ammo physics engine.",backLink:"/particle-collision-with-worker",backLabel:"< Particle Collision with worker",children:[(0,t.jsx)(r.Z,{component:"p",children:"Sorry for lack of live measurements, but it seems to be around 5 times faster then the previous version for 2k particles. It does not run on the github pages for some reason."}),(0,t.jsxs)(s.Z,{spacing:2,direction:"row",style:{flex:1},children:[(0,t.jsx)("div",{style:{flex:2},ref:n}),(0,t.jsxs)(s.Z,{spacing:2,style:{flex:1},children:["World Size: ",d,(0,t.jsx)(o.ZP,{min:10,max:100,step:1,value:d,onChange:function(e,n){return!Array.isArray(n)&&w(n)}}),"Particles Amount: ",m,(0,t.jsx)(o.ZP,{min:10,max:4e3,step:1,value:m,onChange:function(e,n){return!Array.isArray(n)&&x(n)}}),(0,t.jsxs)("div",{children:["FPS: ",(0,t.jsx)("span",{ref:c,children:"0"})]}),(0,t.jsx)(a.Z,{onClick:y,children:"Simulate"})]})]})]})}}},function(e){e.O(0,[737,543,321,507,365,731,774,888,179],(function(){return n=5307,e(e.s=n);var n}));var n=e.O();_N_E=n}]);