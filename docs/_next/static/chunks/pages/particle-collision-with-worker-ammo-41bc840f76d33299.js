(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{5307:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/particle-collision-with-worker-ammo",function(){return i(2690)}])},2690:function(e,n,i){"use strict";i.r(n);var t=i(5893),r=i(6447),s=i(7507),o=i(3321),a=i(7294),u=i(9477),c=i(7995),l=i(8861),h=i(3493),d=i.n(h);var f=function(){function e(n,i){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.shouldStop=!1,this.isInitialized=!1,this.idIndexMap={},this.sphereMeshes=[],this.worldSize=n,this.onFPSUpdate=i}var n=e.prototype;return n.initializeMeshes=function(e){var n=this;this.sphereMeshes=e.map((function(e,i){var t;n.idIndexMap[e.id]=i;var r=new u.xo$(1),s=new u.vBJ({color:16711680}),o=new u.Kj0(r,s);return o.position.set(e.x,e.y,e.z),null===(t=n.scene)||void 0===t||t.add(o),o}))},n.update=function(e){var n=this;if(!this.isInitialized)return this.initializeMeshes(e),void(this.isInitialized=!0);e.forEach((function(e){!function(e,n){e.position.x=n.x,e.position.y=n.y,e.position.z=n.z,e.quaternion.x=n.quaternionX,e.quaternion.y=n.quaternionY,e.quaternion.z=n.quaternionZ,e.quaternion.w=n.quaternionW}(n.sphereMeshes[n.idIndexMap[e.id]],e)}))},n.startAnimation=function(e){var n=this,i=(0,c.Y)(e,this.worldSize),t=i.scene,r=i.render,s=i.removeScene;this.scene=t;var o=Date.now(),a=function(){if(n.shouldStop)s();else{var e=Date.now();n.onFPSUpdate(1e3/(e-o)),o=e,requestAnimationFrame(a),r()}};a()},n.stopAnimation=function(){this.shouldStop=!0},e}();n.default=function(){var e=(0,a.useRef)(),n=(0,a.useRef)(null),u=(0,a.useRef)(null),c=(0,a.useState)(10),h=c[0],p=c[1],w=(0,a.useState)(10),v=w[0],m=w[1],x=(0,a.useRef)();(0,a.useEffect)((function(){return x.current=new Worker(new URL(i.p+i.u(131),i.b)),function(){var e;null===(e=x.current)||void 0===e||e.terminate()}}),[]);var y=(0,a.useCallback)((function(){var i,t;if(n.current&&x.current){e.current&&(e.current.stopAnimation(),x.current.postMessage({type:"STOP"}));e.current=new f(h,d()((function(e){u.current&&(u.current.innerText=e.toFixed(0))}),1e3)),e.current.startAnimation(n.current),x.current.onmessage=function(n){var i;null===(i=e.current)||void 0===i||i.update(n.data)},null===(i=x.current)||void 0===i||i.postMessage({type:"INITIALIZE",worldSize:h,particlesAmount:v}),null===(t=x.current)||void 0===t||t.postMessage({type:"START"})}}),[v,h]);return(0,t.jsx)(l.T,{title:"Particle simulation with collisions and webworker",subtitle:"The same as before but this time I'm using ammo physics engine",backLink:"/particle-collision-with-worker",backLabel:"< Particle Collision with worker",children:(0,t.jsxs)(r.Z,{spacing:2,direction:"row",style:{flex:1},children:[(0,t.jsx)("div",{style:{flex:2},ref:n}),(0,t.jsxs)(r.Z,{spacing:2,style:{flex:1},children:["World Size: ",h,(0,t.jsx)(s.ZP,{min:10,max:100,step:1,value:h,onChange:function(e,n){return!Array.isArray(n)&&p(n)}}),"Particles Amount: ",v,(0,t.jsx)(s.ZP,{min:10,max:2e3,step:1,value:v,onChange:function(e,n){return!Array.isArray(n)&&m(n)}}),(0,t.jsxs)("div",{children:["FPS: ",(0,t.jsx)("span",{ref:u,children:"0"})]}),(0,t.jsx)(o.Z,{onClick:y,children:"Simulate"})]})]})})}}},function(e){e.O(0,[737,543,321,507,365,731,774,888,179],(function(){return n=5307,e(e.s=n);var n}));var n=e.O();_N_E=n}]);