!function(){"use strict";var t=function(t,n){return Math.random()*(n-t)+t};importScripts("../../../ammo.wasm.js");var n={locateFile:function(){return"../../../ammo.wasm.wasm"}},i=new(function(){function i(){var t=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),this.particlesInfo=[],this.shouldStop=!1,this.getBoundry=function(n,i,o,e){var r=t.ammo;if(r){var a=new r.btBoxShape(new r.btVector3(n/2,n/2,n/2)),s=new r.btTransform;s.setIdentity(),s.setOrigin(new r.btVector3(i,o,e));var d=new r.btVector3(0,0,0),l=new r.btDefaultMotionState(s),u=new r.btRigidBodyConstructionInfo(0,l,a,d);return new r.btRigidBody(u)}}}var o=i.prototype;return o.loadAmmo=function(){if(!this.ammo){var t=this;return Ammo(n).then((function(n){t.ammo=n}))}return Promise.resolve()},o.initializeBoundries=function(t){var n,i,o,e,r;if(this.ammo){var a=t,s=a/2,d=this.getBoundry(t,s,-s,s),l=this.getBoundry(t,-s,s,s),u=this.getBoundry(t,a+s,s,s),c=this.getBoundry(t,s,s,-s),f=this.getBoundry(t,s,s,a+s);null===(n=this.world)||void 0===n||n.addRigidBody(d),null===(i=this.world)||void 0===i||i.addRigidBody(l),null===(o=this.world)||void 0===o||o.addRigidBody(u),null===(e=this.world)||void 0===e||e.addRigidBody(c),null===(r=this.world)||void 0===r||r.addRigidBody(f)}},o.initEngine=function(n,i){var o=this;this.loadAmmo().then((function(){var e,r=o,a=o.ammo,s=new a.btDefaultCollisionConfiguration,d=new a.btCollisionDispatcher(s),l=new a.btDbvtBroadphase,u=new a.btSequentialImpulseConstraintSolver;o.world=new a.btDiscreteDynamicsWorld(d,l,u,s),null===(e=o.world)||void 0===e||e.setGravity(new a.btVector3(0,-9.82,0)),o.initializeBoundries(n),o.particles=new Array(i).fill(0).map((function(){var i,o=new a.btSphereShape(1),e=new a.btTransform;e.setIdentity();var s=new a.btVector3(0,0,0);o.calculateLocalInertia(1,s),e.setOrigin(new a.btVector3(t(0,n),t(0,n),t(0,n)));var d=new a.btDefaultMotionState(e),l=new a.btRigidBodyConstructionInfo(1,d,o,s),u=new a.btRigidBody(l);return null===(i=r.world)||void 0===i||i.addRigidBody(u),u}));var c=new a.btTransform;o.trans=c,o.particlesInfo=o.particles.map((function(t,n){var i;null===(i=t.getMotionState())||void 0===i||i.getWorldTransform(c);var o=c.getOrigin(),e=c.getRotation();return{id:n,x:o.x(),y:o.y(),z:o.z(),quaternionX:e.x(),quaternionY:e.y(),quaternionZ:e.z(),quaternionW:e.w()}}))}))},o.sendUpdate=function(){var t=this;if(this.particles){var n=this.trans;n&&(this.particles.forEach((function(i,o){var e;null===(e=i.getMotionState())||void 0===e||e.getWorldTransform(n);var r=n.getOrigin(),a=n.getRotation();t.particlesInfo[o].id=o,t.particlesInfo[o].x=r.x(),t.particlesInfo[o].y=r.y(),t.particlesInfo[o].z=r.z(),t.particlesInfo[o].quaternionX=a.x(),t.particlesInfo[o].quaternionY=a.y(),t.particlesInfo[o].quaternionZ=a.z(),t.particlesInfo[o].quaternionW=a.w()})),postMessage(this.particlesInfo))}},o.start=function(){var t=this;this.shouldStop=!1;var n=1/60,i=Date.now()-16.666666666666668,o=function(e){var r;if(!t.shouldStop){requestAnimationFrame(o);var a=(e-i)/1e3;null===(r=t.world)||void 0===r||r.stepSimulation(n,a),t.sendUpdate(),i=e}};o(i+16.666666666666668)},o.stop=function(){this.shouldStop=!0},i}());addEventListener("message",(function(t){var n=t.data;if("INITIALIZE"===n.type){var o=t.data,e=o.worldSize,r=o.particlesAmount;i.initEngine(e,r)}"START"===n.type&&i.start(),"STOP"===n.type&&i.stop()}))}(),_N_E={};